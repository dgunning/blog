<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Building a COVID-19 Research Engine | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Building a COVID-19 Research Engine" />
<meta name="author" content="Dwight Gunning" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge" />
<meta property="og:description" content="The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge" />
<link rel="canonical" href="https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html" />
<meta property="og:url" content="https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:image" content="https://dgunning.github.io/blog/images/covidblue.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-08T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Dwight Gunning"},"headline":"Building a COVID-19 Research Engine","description":"The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge","datePublished":"2020-05-08T00:00:00-05:00","dateModified":"2020-05-08T00:00:00-05:00","image":"https://dgunning.github.io/blog/images/covidblue.png","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html"},"url":"https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://dgunning.github.io/blog/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Building a COVID-19 Research Engine | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Building a COVID-19 Research Engine" />
<meta name="author" content="Dwight Gunning" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge" />
<meta property="og:description" content="The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge" />
<link rel="canonical" href="https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html" />
<meta property="og:url" content="https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:image" content="https://dgunning.github.io/blog/images/covidblue.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-08T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Dwight Gunning"},"headline":"Building a COVID-19 Research Engine","description":"The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge","datePublished":"2020-05-08T00:00:00-05:00","dateModified":"2020-05-08T00:00:00-05:00","image":"https://dgunning.github.io/blog/images/covidblue.png","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html"},"url":"https://dgunning.github.io/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://dgunning.github.io/blog/feed.xml" title="fastpages" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building a COVID-19 Research Engine</h1><p class="page-description">The COVID-19 Open Research Dataset Challenge dataset was created on Kaggle by a coalition of research groups to encourage Kagglers to help find solutions to the COVID-19 pandemic by making it easier to search thousands of medical research papers. This notebook was my contribution to the challenge</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-08T00:00:00-05:00" itemprop="datePublished">
        May 8, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Dwight Gunning</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      32 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#notebooks">notebooks</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#covid19">covid19</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/dgunning/blog/tree/master/_notebooks/2020-05-08-building-a-covid19-research-engine.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/dgunning/blog/master?filepath=_notebooks%2F2020-05-08-building-a-covid19-research-engine.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/dgunning/blog/blob/master/_notebooks/2020-05-08-building-a-covid19-research-engine.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-05-08-building-a-covid19-research-engine.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/blog/images/copied_from_nb/../images/covidblue.png" alt="COVID-19 Virus" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This notebook contains a library called the <strong>CORD Research Engine</strong>, which uses search and NLP technology to simplify searching the CORD Research Paper dataset for information that would help solve the current pandemic"</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Getting-Started">Getting Started<a class="anchor-link" href="#Getting-Started"> </a></h1><h2 id="Data-files">Data files<a class="anchor-link" href="#Data-files"> </a></h2><p>The <em>CORD-19</em> dataset on Kaggle contains over 59,000 research papers. This notebook references about 2,000 of those papers, located in the directory <em>data</em>. Inside the data directory, the CORD Research data is located in the <em>CORD-19-research-challenge</em> subdirectory. For the full dataset please see the competition page on Kaggle.</p>
<h2 id="Navigating-the-data">Navigating the data<a class="anchor-link" href="#Navigating-the-data"> </a></h2><p>The original notebook was a Python kernel on Kaggle. On kaggle the data directory is <em>/kaggle/input</em> and when you launch a new notebook you are given a block of code to view the data in the directory.</p>

<pre><code>import os
for dirname, _, filenames in os.walk('/kaggle/input'):
    for filename in filenames:
        print(os.path.join(dirname, filename))</code></pre>
<h4 id="The-Data-Directory">The Data Directory<a class="anchor-link" href="#The-Data-Directory"> </a></h4><p><img src="/blog/images/copied_from_nb/../images/datadir.png" alt="Data directory" /></p>
<p>Instead of the code above we will use <code>pathlib</code> for navigating the filesystem because it is a little bit easier to use than <code>os.path</code>. From pathlib we will use the <code>Path</code> and <code>PurePath</code> classes. The <code>Path</code> class provides almost all the functionality we need except that it cannot be passed directly into _pandas.read<em>csv</em> as can be done with the <code>PurePath</code>.</p>
<p>Now we can create a Path object at the location of the CORD research data and view the contents of that directory.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/CORD-19-research-challenge&#39;</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">data_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[WindowsPath(&#39;data/CORD-19-research-challenge/biorxiv_medrxiv&#39;),
 WindowsPath(&#39;data/CORD-19-research-challenge/comm_use_subset&#39;),
 WindowsPath(&#39;data/CORD-19-research-challenge/cord_19_embeddings.csv&#39;),
 WindowsPath(&#39;data/CORD-19-research-challenge/custom_license&#39;),
 WindowsPath(&#39;data/CORD-19-research-challenge/metadata.csv&#39;),
 WindowsPath(&#39;data/CORD-19-research-challenge/noncomm_use_subset&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <em>CORD-19</em> data directory contains four sub-directories, the JSON contents of the research papers, and a <em>metadata.csv</em> file with the metadata for all the research papers. For the actual details of the CORD Research papers dataset, see the description on the Kaggle site.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Research-Engine-Design">Research Engine Design<a class="anchor-link" href="#Research-Engine-Design"> </a></h1><h2 id="A-tale-of-two-indexes">A tale of two indexes<a class="anchor-link" href="#A-tale-of-two-indexes"> </a></h2><p>We will build two <em>indexes</em> into the data: one for <em>search</em>, and one for <em>similarity</em>. An index is just a data structure that provides a way to sort some data. In our case, for search, we want to provide a search term to the index and have it return a list of the research papers, sorted by most relevant to the search term.</p>
<p>With the <em>similarity</em> index, the goal is to provide a research paper as input and have the index return a list of papers sorted by the most similar to that paper.</p>
<p>In the real world, and for applications that you may write, you may encounter those two use cases, so we will show the best techniques to fulfill the requirements. <em>Search</em> and <em>Similarity</em> are related but not identical areas, and both the indexes we will build are better at one than the other.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Object-Oriented-Design">Object-Oriented Design<a class="anchor-link" href="#Object-Oriented-Design"> </a></h2><p>An object-oriented design is rarely used with notebooks, and for good reason. A notebook is a hybrid of a Python script and a layout template, which both operate in a top to bottom way. Objects are usually meant to be defined in a certain location or context and interacted with multiple times during the course of a program. This is exactly what we want to do here; we intend to create a Research Engine and use it to find research papers during the course of a single session.</p>
<p>There are two main objects in our design: <code>ResearchPapers</code> and <code>Paper</code>. The <code>ResearchPapers</code> class will load and maintain the list of research papers, while <code>Paper</code> will allow us to work with a single research paper.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ResearchPapers</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
        <span class="k">pass</span>
    
<span class="k">class</span> <span class="nc">Paper</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loading-Research-Papers">Loading Research Papers<a class="anchor-link" href="#Loading-Research-Papers"> </a></h1><p>We start with the <em>metadata.csv</em> since this contains the master list of all the research papers and important information about each paper. Some Kaggle kernels started by loading the research papers from the JSON files, but the metadata is considerably smaller, and starting with the metadata might allow us to only load a research paper from a JSON file if required, thereby saving significantly on computational resources.</p>
<h2 id="Load-Metadata">Load Metadata<a class="anchor-link" href="#Load-Metadata"> </a></h2><p>The <code>load_metadata</code> function is straightforward - it uses <code>pandas.read_csv()</code> to load the metadata.csv file. Along the way it changes the data types for the <em>Microsoft Academic Paper ID</em> and _pubmed<em>id</em> columns. It also renames a couple of columns, which is optional, and only to make browsing the data a little easier.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_metadata</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_path</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">find_data_dir</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading metadata from&#39;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
            <span class="n">metadata_path</span> <span class="o">=</span> <span class="n">PurePath</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;metadata.csv&#39;</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Microsoft Academic Paper ID&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;pubmed_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
            <span class="n">renames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;source_x&#39;</span><span class="p">:</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;has_full_text&#39;</span><span class="p">:</span> <span class="s1">&#39;has_text&#39;</span><span class="p">}</span>
            <span class="c1"># Load the metadata using read.csv</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> 
                                   <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;publish_time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renames</span><span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">clean_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
<p>Within <code>load_metadata</code> we call <code>clean_metadata</code>. This function is a data cleaning pipeline that fixes some of the issues with the Kaggle data by using a pipeline of data cleaning functions. Notice that each function is specfic to a task, and named specifically for that task, which makes it simple to remove or add cleaning functions. This is important since a new version of the CORD research data is released every week, with new data fixes, so if you can quickly modify your data pipeline, it gives you an advantage.</p>
<h2 id="Clean-Metadata">Clean Metadata<a class="anchor-link" href="#Clean-Metadata"> </a></h2><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cleaning metadata&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">clean_title</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">clean_abstract</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">rename_publish_time</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">add_date_diff</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">drop_missing</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fill_nulls</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">apply_tags</span><span class="p">)</span>
</pre></div>
<p>Each function in the <code>clean_metadata</code> pipeline accepts a dataframe and returns the dataframe after modification. The functions are connected by the pandas dataframe <code>pipe</code> function, which is designed for this use case of connecting functions sequentially. At the start of the pipeline is a special function called <code>start</code> which is defined as:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
<p>This returns a copy of the data at the start of a data pipeline. This is very important; it makes sure that the initial data is unchanged and enables you to rerun your notebook from any point without worrying that your data has changed in a way that breaks it. This is a pattern I learned from the presentation <strong><a href="https://www.youtube.com/watch?v=yXGCKqo5cEY">Untitled12.ipynb</a>  by Vincent D Warmerdam</strong> at <em>PyData Eindhoven 2019</em></p>
<p>Each subsequent function in the pipeline accepts a dataframe and returns a dataframe. Here is <code>clean_title</code>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_title</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Set junk titles to &#39;&#39;</span>
    <span class="n">title_relevant</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_relevant_re_</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">title_short</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span>
    <span class="n">title_junk</span> <span class="o">=</span> <span class="n">title_short</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">title_relevant</span>
    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">title_junk</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-function">Load function<a class="anchor-link" href="#Load-function"> </a></h2><p>After loading the metadata, we have the <code>load</code> function. This is the static function on the <code>ResearchPapers</code> class that actually creates the ResearchPapers instance using <code>ResearchPapers.load()</code>.</p>
<div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="n">find_data_dir</span><span class="p">()</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_metadata</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preprocessing">Preprocessing<a class="anchor-link" href="#Preprocessing"> </a></h2><p>While the <code>clean_metadata</code> function does some text preprocessing, it does that in relation to the <em>metadata.csv</em> file that is released by Kaggle to remove any data issues it might have. We still need to do text preprocessing to prepare the text of the research papers for storing in the <em>search</em> and <em>similarity</em> indexes. Text preprocessing is a necessary part of NLP projects, and, despite the fact that there are a lot of utilities available in NLP libraries to preprocess test, it is still part of the art of being an NLP practictioner. For example, the regex below was hand-crafted with input from Google searches, and a lot of trial and error. I found, for example, that the text prepeocessing that came with gensim was hand-rolled. You may or may not need to follow a similar process for your own text preprocessing, depending on your judgement.</p>
<div class="highlight"><pre><span></span><span class="n">TOKEN_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^(20|19)\d</span><span class="si">{2}</span><span class="s1">|(?=[A-Z])[\w\-\d]+$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">replace_punctuation</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\(|\)|:|,|;|\.|’|”|“|\?|%|&gt;|&lt;|≥|≤|~|`&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">replace_punctuation</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">SIMPLE_STOPWORDS</span>
            <span class="ow">and</span> <span class="n">TOKEN_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="p">]</span>

<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tokens</span>
</pre></div>
<h3 id="The-preprocess-function">The preprocess function<a class="anchor-link" href="#The-preprocess-function"> </a></h3><p>Regardless, every NLP project requires a <code>preprocess</code> or equivalent function. Our <code>preprocess</code> function converts the text to lowercase, removes punctuation, and converts the text to tokens. What is very important is that the identical preprocess function be used when preparing the text in batch mode as when using it in query mode. So the preprocess function will be used again on each search query to match accurately against what is stored in the index.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Utility-Functions">Utility Functions<a class="anchor-link" href="#Utility-Functions"> </a></h1><h2 id="Parallel-Processing">Parallel Processing<a class="anchor-link" href="#Parallel-Processing"> </a></h2><p>As of the May 2nd data release the <em>CORD Research Paper</em> dataset was over <strong>8GB</strong> in size, with more than 59,000 metadata records and well over 60,000 research papers on disk. In order to process the data in a reasonable amount of time, we added a utility function that will run a given function on a list of data using as many cores that are available.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parallel</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Call `func` on every element of `arr` in parallel using `max_workers`.&quot;</span>
    <span class="n">max_workers</span> <span class="o">=</span> <span class="n">ifnone</span><span class="p">(</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
    <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">futures_to_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">ex</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">)}</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures_to_index</span><span class="p">):</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">futures_to_index</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()))</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">.</span><span class="n">total</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">result</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</pre></div>
<p>For example, if we have a list of JSON files and we want to convert that to a ist of tokenized text we can do:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_tokens</span><span class="p">(</span><span class="n">cord_path</span><span class="p">):</span>
    <span class="n">cord_uid</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">cord_path</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">load_text</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cord_uid</span><span class="p">,</span> <span class="n">tokens</span>
    <span class="k">return</span> <span class="n">cord_uid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">cord_tokens</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">(</span><span class="n">get_tokens</span><span class="p">,</span> <span class="n">cord_paths</span><span class="p">)</span>
</pre></div>
<p>Reading and tokenizing each of the over 60,000 JSON files is a very expensive operation, so we want to distribute this load across our CPU cores.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Describe-the-Metadata">Describe the Metadata<a class="anchor-link" href="#Describe-the-Metadata"> </a></h2><p>The <code>pandas</code> function <code>describe</code> can be used to gather information about <em>series</em> and <em>dataframes</em>.</p>
<p>This is what <code>describe</code> shows when you use it on the metadata without doing any special type of conversions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;metadata.csv&#39;</span><span class="p">)</span>
<span class="n">metadata</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pubmed_id</th>
      <th>Microsoft Academic Paper ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.404000e+03</td>
      <td>3.600000e+01</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.214187e+07</td>
      <td>2.706621e+09</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.717728e+06</td>
      <td>4.306890e+08</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.700200e+04</td>
      <td>1.559092e+09</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.726375e+07</td>
      <td>2.315523e+09</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.375861e+07</td>
      <td>3.003704e+09</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.839937e+07</td>
      <td>3.004938e+09</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.230300e+07</td>
      <td>3.006646e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is a bit limiting, so we will write a function that provides more information than what is available using <code>describe</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">cord.core</span> <span class="kn">import</span> <span class="n">describe_dataframe</span>

<span class="n">describe_dataframe</span><span class="p">(</span><span class="n">metadata</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="ResearchPapers-init">ResearchPapers init<a class="anchor-link" href="#ResearchPapers-init"> </a></h1><p>Now we are at <code>ResearchPapers.__init__()</code>. The <code>ResearchPapers</code> instance is constructed with a metadata dataframe, which is the dataframe we parsed in <code>load_metadata</code>. A <code>ResearchPapers</code> instance can also be constructed with a subset of the metadata, meaning that we can create an instance containing only COVID-19 related papers, or papers published by <strong>Elsevier</strong> or any other subset of the metadata that we are interested in. We will show how to use this functionality later.</p>
<p>We can construct the <em>BM25</em> index from the papers referenced by the metadata. Each metadata row has an <em>abstract</em> column, which contains the abstract of the research paper, which we can preprocess into the index tokens needed by the index. We can, alternatively, create the index tokens from the full text content of the paper, which we load from disk. The full text content gives the potential for a more accurate search, with the tradeoff that it takes a much longer time to build the index. To enable this tradeoff, the <code>load</code> function accepts a parameter <code>index</code>, which deteremines which index strategy to use. <code>ResearchPapers.load(index="text")</code> loaded and indexed from the JSON file contents, while <code>ResearchPapers.load(index"abstract")</code> used the metadata abstract. On a Kaggle instance it took approximately <strong>100</strong> seconds to index from the abstracts versus over <strong>2,000</strong> seconds to index from the JSON texts, though it was about three times faster for each operation on my local laptop.</p>
<p>To save on the time to load from the JSON texts the <em>CORD</em> library, JSON index tokens were processed offline and saved to parquet files. These parquet files were then loaded whenever the option <code>index="text"</code> was selected.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_results</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">if</span> <span class="s1">&#39;index_tokens&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Indexing research papers&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">index</span> <span class="o">==</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;texts&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">]]):</span>
                <span class="n">tick</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">_set_index_from_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished indexing in&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tick</span><span class="p">),</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating the BM25 index from the abstracts of the papers&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Use index=&quot;text&quot; if you want to index the texts of the paper instead&#39;</span><span class="p">)</span>
                <span class="n">tick</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;index_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">preprocess</span><span class="p">)</span>
                <span class="n">tock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished Indexing in&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">tock</span> <span class="o">-</span> <span class="n">tick</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span>

        <span class="c1"># Create BM25 search index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bm25</span> <span class="o">=</span> <span class="n">_get_bm25Okapi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">index_tokens</span><span class="p">)</span>
</pre></div>
<h2 id="Python-Objects-wrapping-dataframes">Python Objects wrapping dataframes<a class="anchor-link" href="#Python-Objects-wrapping-dataframes"> </a></h2><p>A pattern that is repeated throughout the project is to have a dataframe as a member of a python object. The python object controls access to the dataframe and provides useful functionality, while the dataframe acts as a local database. There are many use cases that fit this pattern where you load read-only data into a dataframe and wrap python code around it. In our case the <code>ResearchPapers</code> class acts like a miniature application that accesses a local in-memory database. We also do this with the <code>SearchResults</code> object, which wraps a dataframe of the search results.</p>
<p>The most important line above <code>self.metadata = metadata</code> sets the dataframe as an instance member. The primary use is to load all the research papers from the <em>metadata.csv</em>, in which case we will have all 50,000+ research papers. Note that we can pass a metadata dataframe of any number of records, meaning that we can make subsets of <code>ResearchPapers</code>. This enables the ability to select only a subset of research papers, e.g. <code>source=="Elsevier"</code>, then make a copy of the <code>ResearchPapers</code> with the smaller number of records.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ResearchPapers</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">new_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                              <span class="n">data_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
                              <span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
</pre></div>
<p>We will see how this pattern is used in more detail later in the notebook.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Indexing-Research-Papers">Indexing Research Papers<a class="anchor-link" href="#Indexing-Research-Papers"> </a></h1><p>Now that we have completed our basic code, we can see the load in action. We will start with loading from the abstracts.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">cord</span> <span class="kn">import</span> <span class="n">ResearchPapers</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Indexing-from-Abstracts">Indexing from Abstracts<a class="anchor-link" href="#Indexing-from-Abstracts"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span> <span class="o">=</span> <span class="n">ResearchPapers</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loading metadata from data\CORD-19-research-challenge
Cleaning metadata
Applying tags to metadata

Indexing research papers
Creating the BM25 index from the abstracts of the papers
Use index=&#34;text&#34; if you want to index the texts of the paper instead
Finished Indexing in 7.0 seconds
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Indexing-from-Texts">Indexing from Texts<a class="anchor-link" href="#Indexing-from-Texts"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span> <span class="o">=</span> <span class="n">ResearchPapers</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loading metadata from data\CORD-19-research-challenge
Cleaning metadata
Applying tags to metadata

Indexing research papers
Creating the BM25 index from the text contents of the papers
There are 2006 papers that will be indexed using the abstract instead of the contents
Finished indexing in 148 seconds
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Viewing-the-Research-Papers">Viewing the Research Papers<a class="anchor-link" href="#Viewing-the-Research-Papers"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h3>CORD 19 Research Papers</h3>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Papers</th>
      <th>Oldest</th>
      <th>Newest</th>
      <th>SARS-COV-2</th>
      <th>SARS</th>
      <th>Coronavirus</th>
      <th>Virus</th>
      <th>Antivirals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>2006</td>
      <td>1967-03-31</td>
      <td>2020-12-31</td>
      <td>227</td>
      <td>134</td>
      <td>384</td>
      <td>1133</td>
      <td>17</td>
    </tr>
  </tbody>
</table>
</div>
<hr />
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>abstract</th>
      <th>journal</th>
      <th>authors</th>
      <th>published</th>
      <th>when</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A model of tripeptidyl-peptidase I (CLN2), a u...</td>
      <td>: Tripeptidyl-peptidase I, also known as CLN2,...</td>
      <td>BMC Struct Biol</td>
      <td>Wlodawer, Alexander; Durell, Stewart R; Li, Mi...</td>
      <td>2003-11-11</td>
      <td>16 years ago</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SARS and hospital priority setting: a qualitat...</td>
      <td>: Priority setting is one of the most difficul...</td>
      <td>BMC Health Serv Res</td>
      <td>Bell, Jennifer AH; Hyland, Sylvia; DePellegrin...</td>
      <td>2004-12-19</td>
      <td>15 years ago</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Trade and Health: Is the Health Community Read...</td>
      <td>There are greater tensions than ever before be...</td>
      <td>PLoS Med</td>
      <td>Lee, Kelley; Koivusalo, Meri</td>
      <td>2005-01-25</td>
      <td>15 years ago</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Reference gene selection for quantitative real...</td>
      <td>Ten potential reference genes were compared fo...</td>
      <td>Virol J</td>
      <td>Radonić, Aleksandar; Thulke, Stefanie; Bae, Hi...</td>
      <td>2005-02-10</td>
      <td>15 years ago</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Australia's international health relations in ...</td>
      <td>A survey for the year 2003 of significant deve...</td>
      <td>Aust New Zealand Health Policy</td>
      <td>Barraclough, Simon</td>
      <td>2005-02-21</td>
      <td>15 years ago</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>Chloroquine : pas d’efficacité sur le virus Ebola</td>
      <td>Chloroquine : pas d’efficacité sur le virus Ebola</td>
      <td>Revue Francophone des Laboratoires</td>
      <td></td>
      <td>2015-11-30</td>
      <td>4 years ago</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>Multiplex PCR tests sentinel the appearance of...</td>
      <td>Background Since the turn of the century seve...</td>
      <td>Journal of Clinical Virology</td>
      <td>Mahony, James B.; Hatchette, Todd; Ojkic, Davo...</td>
      <td>2009-07-31</td>
      <td>11 years ago</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>Identification of a New Antizyme mRNA +1 Frame...</td>
      <td>The expression of eukaryotic antizyme genes r...</td>
      <td>Journal of Molecular Biology</td>
      <td>Ivanov, Ivaylo P; Anderson, Christine B; Geste...</td>
      <td>2004-06-04</td>
      <td>16 years ago</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>Antiviral responses against chicken respirator...</td>
      <td>Some of the respiratory viral infections in c...</td>
      <td>Cytokine</td>
      <td>Barjesteh, Neda; O'Dowd, Kelsey; Vahedi, Seyed...</td>
      <td>2020-03-31</td>
      <td>1 month ago</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>Biochemical evidence for the presence of mixed...</td>
      <td>Coronavirus envelope (E) protein is a small i...</td>
      <td>FEBS Letters</td>
      <td>Yuan, Q.; Liao, Y.; Torres, J.; Tam, J.P.; Liu...</td>
      <td>2006-05-29</td>
      <td>14 years ago</td>
    </tr>
  </tbody>
</table>
<p>2006 rows × 6 columns</p>
</div>
<style>
h3 {color: #4169E1}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Search-Index">The Search Index<a class="anchor-link" href="#The-Search-Index"> </a></h1><p>The search index is built on a BM25 Okapi libray called _rank<em>bm25</em>.</p>
<p>An implementation of BM25 is also available in gensim, but I found _rank<em>bm25</em> was simple to implement.</p>
<ul>
<li><a href="https://pypi.org/project/rank-bm25/">rank_bm25</a></li>
<li><a href="https://github.com/dorianbrown">Dorian Brown (author of rank_bm25)</a></li>
</ul>
<h2 id="What-is-BM25-Okapi?">What is BM25 Okapi?<a class="anchor-link" href="#What-is-BM25-Okapi?"> </a></h2><p>BM25 stands for <em>Best Match the 25th version</em> and is a text search algorithm first developed in 1994. Okapi stands for the <em>Okapi information retrieval system</em>, implemented at London's City University in the 1980s and 1990s on which BM25 was used.</p>
<p>It is one of the best search algorithms available, and Lucene and its derivatives, Solr and ElasticSearch switched to a BM25 variant around 2015.</p>
<h2 id="Creating-the-BM25-Index">Creating the BM25 Index<a class="anchor-link" href="#Creating-the-BM25-Index"> </a></h2><p>The heart of this notebook, the one forked over 400 times on Kaggle, is this line of code.</p>
<div class="highlight"><pre><span></span><span class="n">BM25Okapi</span><span class="p">(</span><span class="n">index_tokens</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
<p>This creates a new <em>BM25Okapi</em> index on the index_tokens. The index accepts a list of tokens, with each item in the list representing a single tokenized research paper. This is as simple as you can get for a bit of technology that is also used in <strong>ElasticSearch</strong> software.</p>
<p>The actual implementation in the library is just slightly more complicated, accounting for the edge case of creating a <code>ResearchPapers</code> instance with no papers inside. (This can happen, as we see below, if our API is so flexible that it allows a user to do this).</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rank_bm25</span> <span class="kn">import</span> <span class="n">BM25Okapi</span>

<span class="k">def</span> <span class="nf">_get_bm25Okapi</span><span class="p">(</span><span class="n">index_tokens</span><span class="p">):</span>
    <span class="n">has_tokens</span> <span class="o">=</span> <span class="n">index_tokens</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_tokens</span><span class="p">:</span>
        <span class="n">index_tokens</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;tokens&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">BM25Okapi</span><span class="p">(</span><span class="n">index_tokens</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Searching-Papers">Searching Papers<a class="anchor-link" href="#Searching-Papers"> </a></h2><p>The <code>search</code> function is defined below. We preprocess the search string and then get the doc_scores (the search relevance score) from the BM25 index for all documents in the index. Then we get the dataframe locations of the most relevant papers, do some additional filtering, then return the top <em>n</em> results.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_string</span><span class="p">,</span>
               <span class="n">num_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
               <span class="n">covid_related</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">view</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
        <span class="n">n_results</span> <span class="o">=</span> <span class="n">num_results</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_results</span>

        <span class="c1"># Preprocess the search string</span>
        <span class="n">search_terms</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">search_string</span><span class="p">)</span>

        <span class="c1"># Get the doc scores from the BM25 index</span>
        <span class="n">doc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bm25</span><span class="o">.</span><span class="n">get_scores</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span>

        <span class="c1"># Get the index from the doc scores sorted by most relevant</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">doc_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Sort the metadata using the sorted index above</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Round the doc scores, in case we use the score in the display </span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_scores</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter covid related</span>
        <span class="k">if</span> <span class="n">covid_related</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">covid_related</span><span class="p">]</span>

        <span class="c1"># Filter by dates - start date</span>
        <span class="k">if</span> <span class="n">start_date</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">published</span> <span class="o">&gt;=</span> <span class="n">start_date</span><span class="p">]</span>
        <span class="c1"># end data</span>
        <span class="k">if</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">published</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">]</span>

        <span class="c1"># Show only up to n_results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_results</span><span class="p">)</span>

        <span class="c1"># Create the final results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

        <span class="c1"># Return Search Results</span>
        <span class="k">return</span> <span class="n">SearchResults</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">)</span>
</pre></div>
<p>Here is the code run outside of the function, with print statements</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">cord.text</span> <span class="kn">import</span> <span class="n">preprocess</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">search_query</span> <span class="o">=</span> <span class="s1">&#39;Mother to child transmission&#39;</span>
<span class="n">search_tokens</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">search_query</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;search_tokens&#39;</span><span class="p">,</span> <span class="n">search_tokens</span><span class="p">)</span>

<span class="n">doc_scores</span> <span class="o">=</span> <span class="n">papers</span><span class="o">.</span><span class="n">bm25</span><span class="o">.</span><span class="n">get_scores</span><span class="p">(</span><span class="n">search_tokens</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;doc_scores&#39;</span><span class="p">,</span> <span class="n">doc_scores</span><span class="p">)</span>

<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">doc_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ind&#39;</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>search_tokens [&#39;mother&#39;, &#39;child&#39;, &#39;transmission&#39;]
doc_scores [0. 0. 0. ... 0. 0. 0.]
ind [1451 1543   82 ... 1320 1322    0]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Similarity-Index">The Similarity Index<a class="anchor-link" href="#The-Similarity-Index"> </a></h2><p>Included with the <em>CORD-19 Research Dataset</em> is a CSV file containing the document embeddings vectors for the papers in the dataset. Each vector is a 768-dimension vector representing  what a neural network has learned about that research paper, and, effectively, it is a signature or a fingerprint of that research paper. This vector can be used to build our <em>similarity index</em> and allow us to find similar papers for any given research paper.</p>
<p><img src="/blog/images/copied_from_nb/../images/search2d.png" alt="Search2d" /></p>
<p>The embeddings CSV file is large—over 700MB in the real dataset. For this notebook we have created a smaller CSV file with only the embeddings for the research papers included with the notebook. If you load and look at the embeddings, you will see 769 columns, one for each of the 768-dimension vector, plus the <em>cord_uid</em>.  (The <em>cord_uid</em> is the unique identifier for a research paper in the dataset.)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embeddings_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;cord_19_embeddings.csv&#39;</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">embeddings_path</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">## Look at the first 2 rows and 5 columns</span>
<span class="n">embeddings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre>(1824, 769)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>5o38ihe0</th>
      <th>-5.601012229919434</th>
      <th>-4.197016716003418</th>
      <th>2.3068416118621826</th>
      <th>5.485584259033203</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>xvi5miqw</td>
      <td>-1.932757</td>
      <td>-4.252481</td>
      <td>-4.315052</td>
      <td>4.177907</td>
    </tr>
    <tr>
      <th>1</th>
      <td>zl5lgcog</td>
      <td>2.447766</td>
      <td>-2.379109</td>
      <td>-0.537503</td>
      <td>4.555745</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us load the data again, but this time add the column names</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">VECTOR_COLS</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">768</span><span class="p">)]</span>
<span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cord_uid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">VECTOR_COLS</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">embeddings_path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;cord_uid&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loaded embeddings of shape&#39;</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">## Look at the first 2 rows and 5 columns</span>
<span class="n">embeddings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loaded embeddings of shape (1825, 768)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>cord_uid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5o38ihe0</th>
      <td>-5.601012</td>
      <td>-4.197017</td>
      <td>2.306842</td>
      <td>5.485584</td>
      <td>3.822709</td>
    </tr>
    <tr>
      <th>xvi5miqw</th>
      <td>-1.932757</td>
      <td>-4.252481</td>
      <td>-4.315052</td>
      <td>4.177907</td>
      <td>-3.749875</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-the-Annoy-Index">Building the Annoy Index<a class="anchor-link" href="#Building-the-Annoy-Index"> </a></h2><p><em>Annoy</em> is a library for building an index of vectors so that the nearest neighbors to that vector can be easily found. This library is used at <strong>Spotify</strong> to find music recommendations, so it is one of the best technologies we can possibly use to find similar papers.</p>
<p>To build an <em>annoy</em> index, you first create it with the vector size that you want to store in the index, then add each vector to the index, then build.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">annoy</span> <span class="kn">import</span> <span class="n">AnnoyIndex</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">VECTOR_SIZE</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">annoy_index</span> <span class="o">=</span> <span class="n">AnnoyIndex</span><span class="p">(</span><span class="n">VECTOR_SIZE</span><span class="p">,</span> <span class="s1">&#39;angular&#39;</span><span class="p">)</span>  <span class="c1"># Length of item vector that will be indexed</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectors</span><span class="p">):</span>
    <span class="n">annoy_index</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>

<span class="n">annoy_index</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># 10 trees</span>
<span class="n">annoy_index</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;test.ann&#39;</span><span class="p">)</span>
</pre></div>
<h3 id="Reduce-Vector-Dimensions">Reduce Vector Dimensions<a class="anchor-link" href="#Reduce-Vector-Dimensions"> </a></h3><p>For the index we wanted to create, we thought 768 dimensions was too much, especially since it meant that the resulting index would be very large on disk, and also too large to fit into a Git repository. Therefore we used <em>PCA</em> to reduce the dimensions to 192, and those <strong>192</strong> dimensional vectors are stored in the <em>Annoy Index</em>.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span><span class="n">docvectors</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Downsampling to </span><span class="si">{</span><span class="n">dimensions</span><span class="si">}</span><span class="s1">D embeddings&#39;</span><span class="p">)</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">svd_solver</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    <span class="n">docvectors_downsampled</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">docvectors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">docvectors_downsampled</span><span class="p">),</span> <span class="n">pca</span>
</pre></div>
<h3 id="Getting-Similar-Vectors">Getting Similar Vectors<a class="anchor-link" href="#Getting-Similar-Vectors"> </a></h3><p>Once we have the <em>annoy index</em>, we use it to find similar papers using the <code>similar papers</code> function. <em>Annoy</em> has two functions for finding similar papers: <code>get_nns_by_item</code> and <code>get_nns_by_vector</code>. In our function we use <code>get_nns_by_item</code>.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">similar_papers</span><span class="p">(</span><span class="n">paper_id</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_similar_items</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.vectors</span> <span class="kn">import</span> <span class="n">SPECTOR_SIMILARITY_INDEX</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">paper_id</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paper_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">get_index</span><span class="p">(</span><span class="n">paper_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">similar_indexes</span> <span class="o">=</span> <span class="n">SPECTOR_SIMILARITY_INDEX</span><span class="o">.</span><span class="n">get_nns_by_item</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">num_items</span><span class="p">,</span> <span class="n">search_k</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">search_k</span><span class="p">)</span>
    <span class="n">similar_cord_uids</span> <span class="o">=</span> <span class="n">document_vectors</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">similar_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">id</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">similar_cord_uids</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span> <span class="o">==</span> <span class="n">paper_id</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Displaying-objects-in-a-notebook">Displaying objects in a notebook<a class="anchor-link" href="#Displaying-objects-in-a-notebook"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the search function we returned a <code>SearchResults</code> object that contained a dataframe with the search results. This is a common pattern used in the notebook—often a dataframe is wrapped inside of an object.</p>
<p>The reason for this pattern is to control how the dataframe is displayed in the notebook. For the search result, we want to present a different formatting from what is available for dataframes, and we may also want to control which columns are displayed, or other aspects of the search results.</p>
<h3 id="Outputting-HTML">Outputting HTML<a class="anchor-link" href="#Outputting-HTML"> </a></h3><p>Objects can control how they are displayed as HTML in a Jupyter notebook by implementing the <code>_repr_html_()</code> function. Some of the objects that we create in this project are meant to wrap a dataframe and control how they are displayed. <code>SearchResults</code> is one such object—it wraps the results dataframe and controls how it looks using <code>_repr_html_()</code>. <code>SearchResults</code> can actually be viewed as a dataframe</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Mother to child&#39;</span><span class="p">,</span> <span class="n">covid_related</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>summary</th>
      <th>when</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1451</th>
      <td>Investigation on demands for antenatal care se...</td>
      <td>Objective To identify problems and demands for...</td>
      <td>4 months ago</td>
    </tr>
    <tr>
      <th>664</th>
      <td>Lessons learned from Korea: COVID-19 pandemic</td>
      <td>Lessons learned from Korea: COVID-19 pandemic</td>
      <td>1 month ago</td>
    </tr>
    <tr>
      <th>642</th>
      <td>Editorial. Impact of COVID-19 on neurosurgery ...</td>
      <td>Editorial. Impact of COVID-19 on neurosurgery ...</td>
      <td>3 weeks ago</td>
    </tr>
    <tr>
      <th>643</th>
      <td>Editorial. Innovations in neurosurgical educat...</td>
      <td>Editorial. Innovations in neurosurgical educat...</td>
      <td>3 weeks ago</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>or an HTML table:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Mother to child&#39;</span><span class="p">,</span> <span class="n">covid_related</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

 <h4 class="cord">Investigation on demands for antenatal care services among 2 002 pregnant women during the epidemic of coronavirus disease 2019 in Shanghai</h4>
 <div id="published_when">
     <span class="published">4 months ago</span>
     
        <a href="#" rel="noopener noreferrer" target="_blank" class="link">Link</a> <span id="cord_uid">ndbc4kga</span>
     
 </div>
 <div class="abstract">Objective To identify problems and demands for antenatal care (ANC) among pregnant women in different trimesters of pregnancy in Shanghai for optimizing ANC service during the epidemic of coronavirus disease 2019 (COVID-19).
Methods Organized by Maternal and Child Health Care institute in the 16 districts of Shanghai, a cross sectional study was conducted among pregnant women who came to pregnancy registration in the community health centers or attended ANC in maternity hospitals from February 7...</div>
 <div class="authors">DU, Li; GU, Yibin; CUI, Mengqing; LI, Wenxian; WANG, Jie; ZHU, Liping; XU, Biao</div>


 <h4 class="cord">Lessons learned from Korea: COVID-19 pandemic</h4>
 <div id="published_when">
     <span class="published">1 month ago</span>
     
        <a href="http://doi.org/10.1017/ice.2020.104" rel="noopener noreferrer" target="_blank" class="link">Link</a> <span id="cord_uid">w0ud098l</span>
     
 </div>
 <div class="abstract">Lessons learned from Korea: COVID-19 pandemic</div>
 <div class="authors">Moradi, Hazhir; Vaezi, Atefeh</div>



<style>
.authors{
    margin: 4px 0px 15px;
}
.authors { color: #778899}
.published {color: #2F4F4F; font-weight: bold; font-size: 0.9em; margin-right: 10px}
#cord_uid{margin-left: 10px; font-weight: bold; font-size: 0.9em;}
h2.cord, h3.cord, h4.cord {margin: 15px 0px 8px 0px}
h4.cord{color:#008B8B; font-size: 1.1em; margin-top: 25px}
div.abstract { margin: 10px 0px 2px}
div#pubished_when{margin: 10px; display: block}
.link-text {color: #808080; font-size: 0.9em}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://ipython.readthedocs.io/en/stable/config/integrating.html">Integrating your object with IPython</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Using-the-Dataframe-style-function">Using the Dataframe style function<a class="anchor-link" href="#Using-the-Dataframe-style-function"> </a></h3><p>Another great way to customize the look of a dataframe inside a notebook is to use the <code>dataframe.style</code> function. This pandas functionality is pretty powerful and can allow you to completely change how a dataframe is displayed in a notebook.</p>
<p>In the <em>CORD</em> library we wanted to style the results differently from regular dataframes, to improve on the look and feel, and to have the library stand out from the competition. The code below shows how the <code>display</code> function used the style function to change the styling of the results.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">paper_ids</span><span class="p">):</span>

        <span class="c1"># Look up the papers using the paperids and create a dataframe</span>
        <span class="n">_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">paper_ids</span><span class="p">:</span>
            <span class="n">paper</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
            <span class="n">_recs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;published&#39;</span><span class="p">:</span> <span class="n">paper</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">published</span><span class="p">,</span>
                          <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">paper</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                          <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="n">paper</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                          <span class="s1">&#39;when&#39;</span><span class="p">:</span> <span class="n">paper</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">when</span><span class="p">,</span>
                          <span class="s1">&#39;cord_uid&#39;</span><span class="p">:</span> <span class="n">paper</span><span class="o">.</span><span class="n">cord_uid</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_recs</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;published&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;published&#39;</span><span class="p">])</span>

        <span class="c1"># Apply a style to a column</span>
        <span class="k">def</span> <span class="nf">highlight_cols</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;font-size: 1.1em; color: #008B8B; font-weight: bold&#39;</span>

        <span class="c1"># Apply the style above to the title column of the dataframe and hide the index</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">highlight_cols</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">hide_index</span><span class="p">()</span>
</pre></div>
<p>This is how the results are dispayed in the notebook:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="s1">&#39;v3lbrzh8&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style type="text/css">
    #T_18784b8c_91f7_11ea_8bf5_7470fd726a31row0_col0 {
            font-size:  1.1em;
             color:  #008B8B;
             font-weight:  bold;
        }</style><table id="T_18784b8c_91f7_11ea_8bf5_7470fd726a31"><thead>    <tr>        <th class="col_heading level0 col0">title</th>        <th class="col_heading level0 col1">summary</th>        <th class="col_heading level0 col2">when</th>        <th class="col_heading level0 col3">cord_uid</th>    </tr></thead><tbody>
                <tr>
                                <td id="T_18784b8c_91f7_11ea_8bf5_7470fd726a31row0_col0" class="data row0 col0">Biochemical evidence for the presence of mixed membrane topologies of the severe acute respiratory syndrome coronavirus envelope protein expressed in mammalian cells</td>
                        <td id="T_18784b8c_91f7_11ea_8bf5_7470fd726a31row0_col1" class="data row0 col1">Different coronavirus E proteins share striking similarities in biochemical properties and biological functions, but seem to adopt distinct membrane topology.
In this report, we study the membrane topology of the SARS-CoV E protein by immunofluorescent staining of cells differentially permeabilized with detergents and proteinase K protection assay.
It was revealed that both the N- and C-termini of the SARS-CoV E protein are exposed to the cytoplasmic side of the membranes (NcytoCcyto).
Intriguingly, a minor proportion of the SARS-CoV E protein was found to be modified by N-linked glycosylation on Asn 66 and inserted into the membranes once with the C-terminus exposed to the luminal side.
The presence of two distinct membrane topologies of the SARS-CoV E protein may provide a useful clue to the pathogenesis of SARS-CoV.</td>
                        <td id="T_18784b8c_91f7_11ea_8bf5_7470fd726a31row0_col2" class="data row0 col2">14 years ago</td>
                        <td id="T_18784b8c_91f7_11ea_8bf5_7470fd726a31row0_col3" class="data row0 col3">v3lbrzh8</td>
            </tr>
    </tbody></table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For more information on styling dataframes see <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/style.html">Pandas Styling</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Creating-Search-Widgets">Creating Search Widgets<a class="anchor-link" href="#Creating-Search-Widgets"> </a></h1><p>To create interactivity within the notebook, and to allow the user to perform interactive searches, we use <code>ipywidgets</code>.</p>
<h3 id="Search-Date-Slider">Search Date Slider<a class="anchor-link" href="#Search-Date-Slider"> </a></h3><p>This widget displays a slider that allows a user to select relevant dates for the <code>Research</code> paper search:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SearchDatesSlider</span><span class="p">():</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39; 1951 &#39;</span><span class="p">,</span> <span class="s1">&#39;1951-01-01&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39; SARS 2003 &#39;</span><span class="p">,</span> <span class="s1">&#39;2002-11-01&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39; H1N1 2009 &#39;</span><span class="p">,</span> <span class="s1">&#39;2009-04-01&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39; COVID 19 &#39;</span><span class="p">,</span> <span class="s1">&#39;2019-11-30&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39; 2020 &#39;</span><span class="p">,</span> <span class="s1">&#39;2020-12-31&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">SelectionRangeSlider</span><span class="p">(</span>
        <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Dates&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2002-11-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-12-31&#39;</span><span class="p">),</span>
        <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;480px&#39;</span><span class="p">}</span>
    <span class="p">)</span>
</pre></div>
<h3 id="SearchBar">SearchBar<a class="anchor-link" href="#SearchBar"> </a></h3><p>For the search bar we add a <strong>Text</strong>, <strong>Button</strong>, <strong>Checkbox</strong> and use <strong>HBox</strong> and <strong>VBox</strong> for layout.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">searchbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_search_terms</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">text_input</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;400px&#39;</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">initial_search_terms</span><span class="p">)</span>

        <span class="n">search_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Search&#39;</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span>
                                       <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;100px&#39;</span><span class="p">))</span>
        <span class="n">search_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">text_input</span><span class="p">,</span> <span class="n">search_button</span><span class="p">])</span>

        <span class="c1"># A COVID-related checkbox</span>
        <span class="n">covid_related_CheckBox</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Covid-19 related&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">checkboxes</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">covid_related_CheckBox</span><span class="p">])</span>

        <span class="c1"># A date slider to limit research papers to a date range</span>
        <span class="n">search_dates_slider</span> <span class="o">=</span> <span class="n">SearchDatesSlider</span><span class="p">()</span>

        <span class="n">search_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">search_box</span><span class="p">,</span> <span class="n">search_dates_slider</span><span class="p">,</span> <span class="n">checkboxes</span><span class="p">])</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">do_search</span><span class="p">():</span>
            <span class="n">search_terms</span> <span class="o">=</span> <span class="n">text_input</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">search_terms</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_terms</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="n">search_dates_slider</span><span class="o">.</span><span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_papers</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">SearchTerms</span><span class="o">=</span><span class="n">search_terms</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="n">num_results</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                                    <span class="n">covid_related</span><span class="o">=</span><span class="n">covid_related_CheckBox</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">button_search_handler</span><span class="p">(</span><span class="n">btn</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">do_search</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">text_search_handler</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;old&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)):</span>
                <span class="n">do_search</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">date_handler</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="n">do_search</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">checkbox_handler</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="n">do_search</span><span class="p">()</span>

        <span class="n">search_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">button_search_handler</span><span class="p">)</span>
        <span class="n">text_input</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">text_search_handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">search_dates_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">date_handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">covid_related_CheckBox</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">checkbox_handler</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

        <span class="n">display</span><span class="p">(</span><span class="n">search_widget</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Show the initial terms</span>
        <span class="k">if</span> <span class="n">initial_search_terms</span><span class="p">:</span>
            <span class="n">do_search</span><span class="p">()</span>
</pre></div>
<p>Now we can see the search bar in action. It updates as you change the selections in the form</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">searchbar</span><span class="p">(</span><span class="s1">&#39;Cruise ship&#39;</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/blog/images/copied_from_nb/../images/riskfactors.png" alt="Risk factors" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Subsetting--Research-Papers">Subsetting  Research Papers<a class="anchor-link" href="#Subsetting--Research-Papers"> </a></h1><p>There are many ways to select subsets of research papers including:</p>
<ul>
<li><strong>Papers since SARS</strong>  <code>research_papers.since_sars()</code></li>
<li><strong>Papers since SARS-COV-2</strong> <code>research_papers.since_sarscov2()</code></li>
<li><strong>Papers before SARS</strong> <code>research_papers.before_sars()</code></li>
<li><strong>Papers before SARS-COV-2</strong> <code>research_papers.before_sarscov2()</code></li>
<li><strong>Papers before a date</strong> <code>research_papers.before('1989-09-12')</code></li>
<li><strong>Papers after a date</strong> <code>research_papers.after('1989-09-12')</code></li>
<li><strong>Papers that contains a string</strong> </li>
<li><strong>Papers that match a string (using regex)</strong> </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Papers-published-since-SARS-COV-2">Papers published since SARS-COV-2<a class="anchor-link" href="#Papers-published-since-SARS-COV-2"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">since_sarscov2</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h3>CORD 19 Research Papers</h3>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Papers</th>
      <th>Oldest</th>
      <th>Newest</th>
      <th>SARS-COV-2</th>
      <th>SARS</th>
      <th>Coronavirus</th>
      <th>Virus</th>
      <th>Antivirals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>316</td>
      <td>2019-11-30</td>
      <td>2020-12-31</td>
      <td>227</td>
      <td>1</td>
      <td>130</td>
      <td>176</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
<hr />
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>abstract</th>
      <th>journal</th>
      <th>authors</th>
      <th>published</th>
      <th>when</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>449</th>
      <td>Focusing on Families and Visitors Reduces Heal...</td>
      <td>Healthcare-associated respiratory viral infect...</td>
      <td>Pediatr Qual Saf</td>
      <td>Linam, W. Matthew; Marrero, Elizabeth M.; Hone...</td>
      <td>2019-12-16</td>
      <td>4 months ago</td>
    </tr>
    <tr>
      <th>452</th>
      <td>Willingness to Self-Isolate When Facing a Pand...</td>
      <td>Infected people are isolated to minimize the s...</td>
      <td>Int J Environ Res Public Health</td>
      <td>Zhang, Xiaojun; Wang, Fanfan; Zhu, Changwen; W...</td>
      <td>2019-12-27</td>
      <td>4 months ago</td>
    </tr>
    <tr>
      <th>453</th>
      <td>Causes of fever in Gabonese children: a cross-...</td>
      <td>The causes of infections in pediatric populati...</td>
      <td>Sci Rep</td>
      <td>Fernandes, José Francisco; Held, Jana; Dorn, M...</td>
      <td>2020-02-07</td>
      <td>3 months ago</td>
    </tr>
    <tr>
      <th>454</th>
      <td>Loop-Mediated Isothermal Amplification (LAMP) ...</td>
      <td>The recent outbreak of Zika virus (ZIKV) in th...</td>
      <td>Viruses</td>
      <td>da Silva, Severino Jefferson Ribeiro; Pardee, ...</td>
      <td>2019-12-23</td>
      <td>4 months ago</td>
    </tr>
    <tr>
      <th>455</th>
      <td>Innate Immunity and Pathogenesis of Biliary At...</td>
      <td>Biliary atresia (BA) is a devastating fibro-in...</td>
      <td>Front Immunol</td>
      <td>Ortiz-Perez, Ana; Donnelly, Bryan; Temple, Hal...</td>
      <td>2020-02-25</td>
      <td>2 months ago</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1978</th>
      <td>MERS-CoV as an emerging respiratory illness: A...</td>
      <td>Introduction Middle East Respiratory Coronavi...</td>
      <td>Travel Medicine and Infectious Disease</td>
      <td>Baharoon, Salim; Memish, Ziad A.</td>
      <td>2019-12-31</td>
      <td>4 months ago</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>Mass gathering events and reducing further glo...</td>
      <td>Mass gathering events and reducing further glo...</td>
      <td>The Lancet</td>
      <td>McCloskey, Brian; Zumla, Alimuddin; Ippolito, ...</td>
      <td>2020-04-10</td>
      <td>4 weeks ago</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>New insights on the antiviral effects of chlor...</td>
      <td>ABSTRACT Recently, a novel coronavirus (2019-n...</td>
      <td>International Journal of Antimicrobial Agents</td>
      <td>Devaux, Christian A.; Rolain, Jean-Marc; Colso...</td>
      <td>2020-03-12</td>
      <td>2 months ago</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>A British Society of Thoracic Imaging statemen...</td>
      <td>A British Society of Thoracic Imaging statemen...</td>
      <td>Clinical Radiology</td>
      <td>Nair, A.; Rodrigues, J.C.L.; Hare, S.; Edey, A...</td>
      <td>2020-05-31</td>
      <td>in 3 weeks</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>Antiviral responses against chicken respirator...</td>
      <td>Some of the respiratory viral infections in c...</td>
      <td>Cytokine</td>
      <td>Barjesteh, Neda; O'Dowd, Kelsey; Vahedi, Seyed...</td>
      <td>2020-03-31</td>
      <td>1 month ago</td>
    </tr>
  </tbody>
</table>
<p>316 rows × 6 columns</p>
</div>
<style>
h3 {color: #4169E1}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Papers-with-&quot;bats&quot;-in-the-title">Papers with "bats" in the title<a class="anchor-link" href="#Papers-with-&quot;bats&quot;-in-the-title"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;bats&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h3>CORD 19 Research Papers</h3>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Papers</th>
      <th>Oldest</th>
      <th>Newest</th>
      <th>SARS-COV-2</th>
      <th>SARS</th>
      <th>Coronavirus</th>
      <th>Virus</th>
      <th>Antivirals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>3</td>
      <td>2010-08-15</td>
      <td>2019-02-10</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<hr />
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>abstract</th>
      <th>journal</th>
      <th>authors</th>
      <th>published</th>
      <th>when</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>292</th>
      <td>Prevalence, diversity, and host associations o...</td>
      <td>Bartonella infections were investigated in sev...</td>
      <td>PLoS Negl Trop Dis</td>
      <td>Urushadze, Lela; Bai, Ying; Osikowicz, Lynn; M...</td>
      <td>2017-04-11</td>
      <td>3 years ago</td>
    </tr>
    <tr>
      <th>475</th>
      <td>Detection of adenovirus, papillomavirus and pa...</td>
      <td>Bats play a significant role in maintaining th...</td>
      <td>Arch Virol</td>
      <td>Finoketti, Fernando; dos Santos, Raíssa Nunes;...</td>
      <td>2019-02-10</td>
      <td>1 year ago</td>
    </tr>
    <tr>
      <th>1859</th>
      <td>Identification and complete genome analysis of...</td>
      <td>Among 489 bats of 11 species in China, three ...</td>
      <td>Virology</td>
      <td>Lau, Susanna K.P.; Woo, Patrick C.Y.; Wong, Be...</td>
      <td>2010-08-15</td>
      <td>10 years ago</td>
    </tr>
  </tbody>
</table>
</div>
<style>
h3 {color: #4169E1}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Papers-with-Brian-Mcloskey-as-an-author">Papers with Brian Mcloskey as an author<a class="anchor-link" href="#Papers-with-Brian-Mcloskey-as-an-author"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;.*McCloskey, B&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;authors&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h3>CORD 19 Research Papers</h3>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Papers</th>
      <th>Oldest</th>
      <th>Newest</th>
      <th>SARS-COV-2</th>
      <th>SARS</th>
      <th>Coronavirus</th>
      <th>Virus</th>
      <th>Antivirals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>2</td>
      <td>2017-09-30</td>
      <td>2020-04-10</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<hr />
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>abstract</th>
      <th>journal</th>
      <th>authors</th>
      <th>published</th>
      <th>when</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1552</th>
      <td>The rise of Zika infection and microcephaly: w...</td>
      <td>Objectives To consider why Zika was declared ...</td>
      <td>Public Health</td>
      <td>McCloskey, B.; Endericks, T.</td>
      <td>2017-09-30</td>
      <td>3 years ago</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>Mass gathering events and reducing further glo...</td>
      <td>Mass gathering events and reducing further glo...</td>
      <td>The Lancet</td>
      <td>McCloskey, Brian; Zumla, Alimuddin; Ippolito, ...</td>
      <td>2020-04-10</td>
      <td>4 weeks ago</td>
    </tr>
  </tbody>
</table>
</div>
<style>
h3 {color: #4169E1}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Getting-a-single-research-paper">Getting a single research paper<a class="anchor-link" href="#Getting-a-single-research-paper"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>ResearchPapers</code> class implements <code>__get_item__()</code> so a single <code>ResearchPaper</code> can be accessed using the numeric index of the paper as in:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h4 class="cord">A model of tripeptidyl-peptidase I (CLN2), a ubiquitous and highly conserved member of the sedolisin family of serine-carboxyl peptidases</h4>
<div><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>authors</th>
      <th>cord_uid</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>2003-11-11</td>
      <td>Wlodawer, Alexander; Durell, Stewart R; Li, Mi...</td>
      <td>5o38ihe0</td>
      <td>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2...</td>
    </tr>
  </tbody>
</table>
</div><div>
<h4 class="summary_title">Summary</h4>
<div id="summary">: Tripeptidyl-peptidase I, also known as CLN2, is a member of the family of sedolisins (serine-carboxyl peptidases).
Similar enzymes have been found in the genomic sequences of several species, but neither systematic analyses of their distribution nor modeling of their structures have been previously attempted.
RESULTS: We have analyzed the presence of orthologs of human CLN2 in the genomic sequences of a number of eukaryotic species.
Enzymes with sequences sharing over 80% identity have been found in the genomes of macaque, mouse, rat, dog, and cow.
A three-dimensional model of human CLN2 was built based mainly on the homology with Pseudomonas sp.
The model presented here indicates a very open and accessible active site that is almost completely conserved among all known CLN2 enzymes.</div>
<style>
h2.cord, h3.cord, h4.cord {margin: 15px 0px 8px 0px}
h4.cord{color:#008B8B; font-size: 1.1em; margin-top: 15px}
h4.summary_title{margin-top: 10px}
#summary {max-height:160px; border-bottom: 1px solid #696969;}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's preferable to access a paper using the <strong>cord_uid</strong> since it is a stable identifier. <code>papers["5o38ihe0"]</code> referes to the same research paper</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span><span class="p">[</span><span class="s1">&#39;5o38ihe0&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<h4 class="cord">A model of tripeptidyl-peptidase I (CLN2), a ubiquitous and highly conserved member of the sedolisin family of serine-carboxyl peptidases</h4>
<div><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>authors</th>
      <th>cord_uid</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>2003-11-11</td>
      <td>Wlodawer, Alexander; Durell, Stewart R; Li, Mi...</td>
      <td>5o38ihe0</td>
      <td>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2...</td>
    </tr>
  </tbody>
</table>
</div><div>
<h4 class="summary_title">Summary</h4>
<div id="summary">: Tripeptidyl-peptidase I, also known as CLN2, is a member of the family of sedolisins (serine-carboxyl peptidases).
Similar enzymes have been found in the genomic sequences of several species, but neither systematic analyses of their distribution nor modeling of their structures have been previously attempted.
RESULTS: We have analyzed the presence of orthologs of human CLN2 in the genomic sequences of a number of eukaryotic species.
Enzymes with sequences sharing over 80% identity have been found in the genomes of macaque, mouse, rat, dog, and cow.
A three-dimensional model of human CLN2 was built based mainly on the homology with Pseudomonas sp.
The model presented here indicates a very open and accessible active site that is almost completely conserved among all known CLN2 enzymes.</div>
<style>
h2.cord, h3.cord, h4.cord {margin: 15px 0px 8px 0px}
h4.cord{color:#008B8B; font-size: 1.1em; margin-top: 15px}
h4.summary_title{margin-top: 10px}
#summary {max-height:160px; border-bottom: 1px solid #696969;}
</style>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implementing-getitem">Implementing getitem<a class="anchor-link" href="#Implementing-getitem"> </a></h3><p>The implementation of <code>__getitem__()</code> is simple:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">paper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">cord_uid</span> <span class="o">==</span> <span class="n">item</span><span class="p">]</span>
</pre></div>
<p>The main view of a research paper is the overview, as shown above. This shows a formatted collection of the paper's important fields. There are other views or attributes of research papers, including:</p>
<ul>
<li><strong>Overview</strong>: A nicely formatted view of the paper's important fields</li>
<li><strong>Abstract</strong>: The paper's abstract</li>
<li><strong>Summary</strong>: A summary of the paper's abstract using the <code>TextRank</code> algorithm</li>
<li><strong>Text</strong>: The text in the paper</li>
<li><strong>HTML</strong>: The contents of the paper as somewhat nicely formatted HTML</li>
<li><strong>Text Summary</strong>: The text of the paper, summarized using the <code>TextRank</code> algorithm</li>
</ul>
<p>This is implemented in the following function:</p>
<div class="highlight"><pre><span></span><span class="n">paper</span> <span class="o">=</span> <span class="n">research_papers</span><span class="p">[</span><span class="s1">&#39;asf5c7xu&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">view_paper</span><span class="p">(</span><span class="n">ViewPaperAs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;Overview&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;Abstract&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">abstract</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;Summary of Abstract&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;HTML&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;Text&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ViewPaperAs</span> <span class="o">==</span> <span class="s1">&#39;Summary of Text&#39;</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">text_summary</span><span class="p">)</span>

<span class="n">interact</span><span class="p">(</span><span class="n">view_paper</span><span class="p">,</span>
         <span class="n">ViewPaperAs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Overview&#39;</span><span class="p">,</span> <span class="c1"># Show an overview of the paper&#39;s important fields and statistics</span>
                      <span class="s1">&#39;Abstract&#39;</span><span class="p">,</span> <span class="c1"># Show the paper&#39;s abstract</span>
                      <span class="s1">&#39;Summary of Abstract&#39;</span><span class="p">,</span> <span class="c1"># Show a summary of the paper&#39;s abstract</span>
                      <span class="s1">&#39;HTML&#39;</span><span class="p">,</span> <span class="c1"># Show the paper&#39;s contents as (slightly) formatted HTML</span>
                      <span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="c1"># Show the paper&#39;s contents</span>
                      <span class="s1">&#39;Summary of Text&#39;</span> <span class="c1"># Show a summary of the paper&#39;s content</span>
                     <span class="p">]</span>
        <span class="p">);</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h1><p>In this notebook we showed you how to use search and NLP techniques to build a simple search engine and UI over a set of documents. Hopefully, it can help you create your own solution if you are interested in contributing to the same CORD research paper dataset. However, the code and techniques learned here can be applied to other use cases, so feel free to adapt it to your own purposes.</p>
<p><img src="/blog/images/copied_from_nb/../images/medicalstaff.png" alt="Search2d" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="References">References<a class="anchor-link" href="#References"> </a></h1><ul>
<li><a href="https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge">CORD-19 Research Paper Challenge on Kaggle</a></li>
<li><a href="https://github.com/dgunning/cord19">CORD library on Github</a></li>
</ul>

</div>
</div>
</div>
</div>
 

</div></div></div></div>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="dgunning/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/notebooks/covid19/2020/05/08/building-a-covid19-research-engine.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
